<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>How To: Use geolocation to get a user's location and weather from IP address | Blah, Cloud</title>
<meta name=keywords content="php,website">
<meta name=description content="This is a post about how to use geolocation to get a user's location and weather from their IP address.">
<meta name=author content="Myles Gray">
<link rel=canonical href=https://blah.cloud/miscellaneous/use-geolocation-get-user-location-weather-ip-address/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.e38a41c5e7d4d3ea02d394ee536b3395f1cb27bd5a9162de1e375c7d2d1bc8f0.css integrity="sha256-44pBxefU0+oC05TuU2szlfHLJ71akWLeHjdcfS0byPA=" rel="preload stylesheet" as=style>
<link rel=preload href=/images/logo-title.png as=image>
<link rel=icon href=https://blah.cloud/images/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://blah.cloud/images/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://blah.cloud/images/favicon-32x32.png>
<link rel=apple-touch-icon href=https://blah.cloud/images/apple-touch-icon.png>
<link rel=mask-icon href=https://blah.cloud/images/logo.png>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.88.1">
<meta property="og:title" content="How To: Use geolocation to get a user's location and weather from IP address">
<meta property="og:description" content="This is a post about how to use geolocation to get a user's location and weather from their IP address.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blah.cloud/miscellaneous/use-geolocation-get-user-location-weather-ip-address/"><meta property="og:image" content="https://blah.cloud/images/logo-text.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2011-04-03T18:11:47+00:00">
<meta property="article:modified_time" content="2021-09-02T13:45:00+00:00"><meta property="og:site_name" content="Blah, Cloud">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://blah.cloud/images/logo-text.png">
<meta name=twitter:title content="How To: Use geolocation to get a user's location and weather from IP address">
<meta name=twitter:description content="This is a post about how to use geolocation to get a user's location and weather from their IP address.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"How To: Use geolocation to get a user's location and weather from IP address","item":"https://blah.cloud/miscellaneous/use-geolocation-get-user-location-weather-ip-address/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How To: Use geolocation to get a user's location and weather from IP address","name":"How To: Use geolocation to get a user\u0027s location and weather from IP address","description":"This is a post about how to use geolocation to get a user's location and weather from their IP address.","keywords":["php","website"],"articleBody":"For those of you wondering how weather detection works (had it on the old site), it works through using a geolocation API to look up your IP address and map it against a database of IP locations, which then queries the Yahoo! Weather API. This can be handy for changing your site’s background to match the weather or the local time of the user.\nUpdated 15/05/2012 - Changes to Yahoo! APIs fixed in newest version below.\nFirst we need to assign the user’s IP address from the user agent to a variable.\nif (!empty($_SERVER['HTTP_CLIENT_IP'])) { $ip=$_SERVER['HTTP_CLIENT_IP']; } elseif (!empty($_SERVER['HTTP_X_FORWARDED_FOR'])) { $ip=$_SERVER['HTTP_X_FORWARDED_FOR']; } else { $ip=$_SERVER['REMOTE_ADDR']; } Now we need to get define the variable that passes the string from here to the master PHP file.\n$weather = getWeather($ip); Next we implement the main function of this file that contains the whole process, and calls all the other functions and requests.\nfunction getWeather($ip){ Next we use ipinfodb.com’s API to get the latitude and longitude for the user’s IP address. We then get the XML response from the server and assign it to the $location_xml variable. You will need to get an API key from them here (it’s free). Don’t forget to plug in your API key into the below URL.\n$url = \"http://api.ipinfodb.com/v2/ip_query.php?key=[YOUR-API-KEY-HERE]\u0026ip=\".$ip.\"\u0026timezone=false\"; $location_xml = get_response($url); Then we parse the XML response with regex to find the latitude and longitude and assign them to variables.\n$lat = get_match('/(.*)(.*) We then plug the latitude and longitude into the reverse geo-coder from Yahoo!, this will give us Yahoo!’s WOEID for the location (we use this to lookup the Yahoo! weather API later). And get the response from the server.\n$api_url = \"http://where.yahooapis.com/geocode?q=\".$lat.\",+\".$long.\"\u0026gflags=R\u0026appid=[YOUR-APP-ID]\"; $response = get_response($api_url); Next up, regex to match the WOEID from the XML response\n$woeid = get_match('/(.*) The WOEID is then passed into the Yahoo! weather API.\n$yahoo_url = \"http://weather.yahooapis.com/forecastrss?w=\".$woeid; The response is retrieved from the Yahoo weather server.\n$yahoo_response = get_response($yahoo_url); Regex again, this time to extract the weather code from Yahoo!’s XMl response. This is then passed into the getWeather function.\n$weather_code = get_match('/ code=\"(.*)\"/isU',$yahoo_response); return getWeatherCode($weather_code); } This function is very simplistic. All it really does is group the weather codes into arrays, this way we don’t have to write a comment for every weather condition as we have grouped the similar ones together. It then takes the groups and assigns a text response to them.\nfunction getWeatherCode($code){ $storm = array(0,1,2,3,4,17,35,37,38,39,40,45,47); $snow = array(13,14,15,16,18,25,41,42,46); $fog = array(19,20,21,22); $windy = array(23,24); $rain = array(5,6,7,8,9,10,11,12); $cloudy = array(26,28,27); $partlycloudy = array(29,30,44); $clear = array(33,34,32,31,36); Here we use if statements to assign the text responses to the grouped weather code arrays. Smart/sarcastic responses are optional.\nif(in_array($code,$storm)){ return \"Storms in movies never end well, so get inside. NOW.\"; } else if(in_array($code,$snow)){ return \"It's either Eyjafjallajokull or it's snowing\"; }else if(in_array($code,$fog)){ return \"Foggy... like Stevie Wonder in a maze\"; }else if(in_array($code,$windy)){ return \"Dayum it's windy outside\"; }else if(in_array($code,$rain)){ return \"It's wetter than a rainforst outside\"; }else if(in_array($code,$cloudy)){ return \"Dark and dingey, don't you love where you live?\"; }else if(in_array($code,$partlycloudy)){ return \"Partly Cloudy, like last nights memories\"; }else if(in_array($code,$clear)){ return \"Ahh tranquility :)\"; }else{ return \"Your location is so remote I don't know what the weather is...\"; } } This function takes the URL’s inserted above and then parses the info so just what we need from the page remains.\nfunction get_response($url){ $request = $url; $postargs = 'u='.urlencode('c').'\u0026p='.urlencode('GMXX6091'); $ch = curl_init($request); curl_setopt($ch, CURLOPT_VERBOSE, 1); curl_setopt($ch, CURLOPT_NOBODY, 0); curl_setopt($ch, CURLOPT_HEADER, 0); curl_setopt($ch, CURLOPT_USERAGENT, ''); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); $response = curl_exec($ch); $responseInfo = curl_getinfo($ch); curl_close($ch); return $response; } This last function regex’s the parameters passed into it and returns only one match.\nfunction get_match($regex,$content){ preg_match($regex,$content,$matches); return $matches[1]; } You will then need to include the file in your page above where you call it using (assuming you called it weather.php):\ninclude \"weather.php\"; Then call the function from the file:\necho $weather_class; Why not follow @mylesagray on Twitter for more like this!\n","wordCount":"655","inLanguage":"en","datePublished":"2011-04-03T18:11:47Z","dateModified":"2021-09-02T13:45:00Z","author":{"@type":"Person","name":"Myles Gray","url":"/about"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blah.cloud/miscellaneous/use-geolocation-get-user-location-weather-ip-address/"},"publisher":{"@type":"Organization","name":"Blah, Cloud","logo":{"@type":"ImageObject","url":"https://blah.cloud/images/favicon.ico"}}}</script>
<script defer data-domain=blah.cloud src=https://plausible.io/js/plausible.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<script>var themeColor=getComputedStyle(document.body).getPropertyValue('--primary');document.querySelector('meta[name="theme-color"]').setAttribute('content',themeColor)</script>
<noscript>
<style type=text/css>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(240, 202, 102, 1);--secondary:rgba(216, 214, 197, 1);--tertiary:rgba(128, 130 ,133 , 1);--content:rgba(206, 205, 188, 1);--hljs-bg:#282a36;--code-bg:#282a36;--border:rgba(240, 202, 102, 1)}.list{background:var(--theme)}}</style>
</noscript>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://blah.cloud/ accesskey=h title="Blah, Cloud. (Alt + H)">
<img src=/images/logo-title.png alt=logo aria-label=logo height=40></a>
</div>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
<ul id=menu>
<li>
<a href=https://blah.cloud/blog/ title=blog>
<span>blog</span>
</a>
</li>
<li>
<a href=https://blah.cloud/search/ title=" (Alt + /)" accesskey=/>
<span><svg style="height:1em;margin-top:1.5em" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="fill-current w-5" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span>
</a>
</li>
</ul>
</nav>
</header>
<div class=container>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
How To: Use geolocation to get a user's location and weather from IP address
</h1>
<div class=post-description>
This is a post about how to use geolocation to get a user's location and weather from their IP address.
</div>
<div class=post-meta>April 3, 2011&nbsp;·&nbsp;Myles Gray&nbsp;|&nbsp;<a href=https://github.com/mylesagray/blog/blob/master/content/posts/2011-04-03-use-geolocation-get-user-location-weather-ip-address/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header>
<div class=post-content><p>For those of you wondering how weather detection works (had it on the old site), it works through using a geolocation API to look up your IP address and map it against a database of IP locations, which then queries the Yahoo! Weather API. This can be handy for changing your site&rsquo;s background to match the weather or the local time of the user.</p>
<p><em>Updated 15/05/2012 - Changes to Yahoo! APIs fixed in newest version below.</em></p>
<p>First we need to assign the user&rsquo;s IP address from the user agent to a variable.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>empty</span><span class=p>(</span><span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HTTP_CLIENT_IP&#39;</span><span class=p>]))</span>
  <span class=p>{</span>
    <span class=nv>$ip</span><span class=o>=</span><span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HTTP_CLIENT_IP&#39;</span><span class=p>];</span>
  <span class=p>}</span>
  <span class=k>elseif</span> <span class=p>(</span><span class=o>!</span><span class=k>empty</span><span class=p>(</span><span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HTTP_X_FORWARDED_FOR&#39;</span><span class=p>]))</span>
  <span class=p>{</span>
    <span class=nv>$ip</span><span class=o>=</span><span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HTTP_X_FORWARDED_FOR&#39;</span><span class=p>];</span>
  <span class=p>}</span>
  <span class=k>else</span>
  <span class=p>{</span>
    <span class=nv>$ip</span><span class=o>=</span><span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;REMOTE_ADDR&#39;</span><span class=p>];</span>
  <span class=p>}</span>
</code></pre></div><p>Now we need to get define the variable that passes the string from here to the master PHP file.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=nv>$weather</span> <span class=o>=</span> <span class=nx>getWeather</span><span class=p>(</span><span class=nv>$ip</span><span class=p>);</span>
</code></pre></div><p>Next we implement the main function of this file that contains the whole process, and calls all the other functions and requests.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>function</span> <span class=nf>getWeather</span><span class=p>(</span><span class=nv>$ip</span><span class=p>){</span>
</code></pre></div><p>Next we use <a href=https://www.ipinfodb.com>ipinfodb.com</a>&rsquo;s API to get the latitude and longitude for the user&rsquo;s IP address. We then get the XML response from the server and assign it to the $location_xml variable. You will need to get an API key from them <a href=https://www.ipinfodb.com/register>here</a> (it&rsquo;s free). Don&rsquo;t forget to plug in your API key into the below URL.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=nv>$url</span> <span class=o>=</span> <span class=s2>&#34;http://api.ipinfodb.com/v2/ip_query.php?key=[YOUR-API-KEY-HERE]&amp;ip=&#34;</span><span class=o>.</span><span class=nv>$ip</span><span class=o>.</span><span class=s2>&#34;&amp;timezone=false&#34;</span><span class=p>;</span>
<span class=nv>$location_xml</span> <span class=o>=</span> <span class=nx>get_response</span><span class=p>(</span><span class=nv>$url</span><span class=p>);</span>
</code></pre></div><p>Then we parse the XML response with regex to find the latitude and longitude and assign them to variables.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=nv>$lat</span> <span class=o>=</span> <span class=nx>get_match</span><span class=p>(</span><span class=err>&#39;</span><span class=o>/</span><span class=p>(</span><span class=o>.*</span><span class=p>)(</span><span class=o>.*</span><span class=p>)</span>
</code></pre></div><p>We then plug the latitude and longitude into the reverse geo-coder from Yahoo!, this will give us Yahoo!&rsquo;s WOEID for the location (we use this to lookup the Yahoo! weather API later). And get the response from the server.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=nv>$api_url</span> <span class=o>=</span> <span class=s2>&#34;http://where.yahooapis.com/geocode?q=&#34;</span><span class=o>.</span><span class=nv>$lat</span><span class=o>.</span><span class=s2>&#34;,+&#34;</span><span class=o>.</span><span class=nv>$long</span><span class=o>.</span><span class=s2>&#34;&amp;gflags=R&amp;appid=[YOUR-APP-ID]&#34;</span><span class=p>;</span>
<span class=nv>$response</span> <span class=o>=</span> <span class=nx>get_response</span><span class=p>(</span><span class=nv>$api_url</span><span class=p>);</span>
</code></pre></div><p>Next up, regex to match the WOEID from the XML response</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=nv>$woeid</span> <span class=o>=</span>  <span class=nx>get_match</span><span class=p>(</span><span class=err>&#39;</span><span class=o>/</span><span class=p>(</span><span class=o>.*</span><span class=p>)</span>
</code></pre></div><p>The WOEID is then passed into the Yahoo! weather API.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=nv>$yahoo_url</span> <span class=o>=</span> <span class=s2>&#34;http://weather.yahooapis.com/forecastrss?w=&#34;</span><span class=o>.</span><span class=nv>$woeid</span><span class=p>;</span>
</code></pre></div><p>The response is retrieved from the Yahoo weather server.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=nv>$yahoo_response</span> <span class=o>=</span> <span class=nx>get_response</span><span class=p>(</span><span class=nv>$yahoo_url</span><span class=p>);</span>
</code></pre></div><p>Regex again, this time to extract the weather code from Yahoo!&rsquo;s XMl response. This is then passed into the getWeather function.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=nv>$weather_code</span> <span class=o>=</span> <span class=nx>get_match</span><span class=p>(</span><span class=s1>&#39;/  code=&#34;(.*)&#34;/isU&#39;</span><span class=p>,</span><span class=nv>$yahoo_response</span><span class=p>);</span>
<span class=k>return</span> <span class=nx>getWeatherCode</span><span class=p>(</span><span class=nv>$weather_code</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><p>This function is very simplistic. All it really does is group the weather codes into arrays, this way we don&rsquo;t have to write a comment for every weather condition as we have grouped the similar ones together. It then takes the groups and assigns a text response to them.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>function</span> <span class=nf>getWeatherCode</span><span class=p>(</span><span class=nv>$code</span><span class=p>){</span>
    <span class=nv>$storm</span>          <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>17</span><span class=p>,</span><span class=mi>35</span><span class=p>,</span><span class=mi>37</span><span class=p>,</span><span class=mi>38</span><span class=p>,</span><span class=mi>39</span><span class=p>,</span><span class=mi>40</span><span class=p>,</span><span class=mi>45</span><span class=p>,</span><span class=mi>47</span><span class=p>);</span>
    <span class=nv>$snow</span>           <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=mi>13</span><span class=p>,</span><span class=mi>14</span><span class=p>,</span><span class=mi>15</span><span class=p>,</span><span class=mi>16</span><span class=p>,</span><span class=mi>18</span><span class=p>,</span><span class=mi>25</span><span class=p>,</span><span class=mi>41</span><span class=p>,</span><span class=mi>42</span><span class=p>,</span><span class=mi>46</span><span class=p>);</span>
    <span class=nv>$fog</span>            <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=mi>19</span><span class=p>,</span><span class=mi>20</span><span class=p>,</span><span class=mi>21</span><span class=p>,</span><span class=mi>22</span><span class=p>);</span>
    <span class=nv>$windy</span>          <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=mi>23</span><span class=p>,</span><span class=mi>24</span><span class=p>);</span>
    <span class=nv>$rain</span>           <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>9</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=mi>11</span><span class=p>,</span><span class=mi>12</span><span class=p>);</span>
    <span class=nv>$cloudy</span>         <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=mi>26</span><span class=p>,</span><span class=mi>28</span><span class=p>,</span><span class=mi>27</span><span class=p>);</span>
    <span class=nv>$partlycloudy</span>       <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=mi>29</span><span class=p>,</span><span class=mi>30</span><span class=p>,</span><span class=mi>44</span><span class=p>);</span>
    <span class=nv>$clear</span>          <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=mi>33</span><span class=p>,</span><span class=mi>34</span><span class=p>,</span><span class=mi>32</span><span class=p>,</span><span class=mi>31</span><span class=p>,</span><span class=mi>36</span><span class=p>);</span>
</code></pre></div><p>Here we use <code>if</code> statements to assign the text responses to the grouped weather code arrays. <em>Smart/sarcastic responses are optional.</em></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php>  <span class=k>if</span><span class=p>(</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$code</span><span class=p>,</span><span class=nv>$storm</span><span class=p>)){</span>
        <span class=k>return</span> <span class=s2>&#34;Storms in movies never end well, so get inside. NOW.&#34;</span><span class=p>;</span>
    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$code</span><span class=p>,</span><span class=nv>$snow</span><span class=p>)){</span>
        <span class=k>return</span> <span class=s2>&#34;It&#39;s either Eyjafjallajokull or it&#39;s snowing&#34;</span><span class=p>;</span>
    <span class=p>}</span><span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$code</span><span class=p>,</span><span class=nv>$fog</span><span class=p>)){</span>
        <span class=k>return</span> <span class=s2>&#34;Foggy... like Stevie Wonder in a maze&#34;</span><span class=p>;</span>
    <span class=p>}</span><span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$code</span><span class=p>,</span><span class=nv>$windy</span><span class=p>)){</span>
        <span class=k>return</span> <span class=s2>&#34;Dayum it&#39;s windy outside&#34;</span><span class=p>;</span>
    <span class=p>}</span><span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$code</span><span class=p>,</span><span class=nv>$rain</span><span class=p>)){</span>
        <span class=k>return</span> <span class=s2>&#34;It&#39;s wetter than a rainforst outside&#34;</span><span class=p>;</span>
    <span class=p>}</span><span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$code</span><span class=p>,</span><span class=nv>$cloudy</span><span class=p>)){</span>
        <span class=k>return</span> <span class=s2>&#34;Dark and dingey, don&#39;t you love where you live?&#34;</span><span class=p>;</span>
    <span class=p>}</span><span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$code</span><span class=p>,</span><span class=nv>$partlycloudy</span><span class=p>)){</span>
        <span class=k>return</span> <span class=s2>&#34;Partly Cloudy, like last nights memories&#34;</span><span class=p>;</span>
    <span class=p>}</span><span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$code</span><span class=p>,</span><span class=nv>$clear</span><span class=p>)){</span>
        <span class=k>return</span> <span class=s2>&#34;Ahh tranquility :)&#34;</span><span class=p>;</span>
    <span class=p>}</span><span class=k>else</span><span class=p>{</span>
        <span class=k>return</span> <span class=s2>&#34;Your location is so remote I don&#39;t know what the weather is...&#34;</span><span class=p>;</span>
    <span class=p>}</span>
  <span class=p>}</span>
</code></pre></div><p>This function takes the URL&rsquo;s inserted above and then parses the info so just what we need from the page remains.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>function</span> <span class=nf>get_response</span><span class=p>(</span><span class=nv>$url</span><span class=p>){</span>
    <span class=nv>$request</span> <span class=o>=</span> <span class=nv>$url</span><span class=p>;</span>
        <span class=nv>$postargs</span> <span class=o>=</span> <span class=s1>&#39;u=&#39;</span><span class=o>.</span><span class=nx>urlencode</span><span class=p>(</span><span class=s1>&#39;c&#39;</span><span class=p>)</span><span class=o>.</span><span class=s1>&#39;&amp;p=&#39;</span><span class=o>.</span><span class=nx>urlencode</span><span class=p>(</span><span class=s1>&#39;GMXX6091&#39;</span><span class=p>);</span>
        <span class=nv>$ch</span> <span class=o>=</span> <span class=nx>curl_init</span><span class=p>(</span><span class=nv>$request</span><span class=p>);</span>

        <span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_VERBOSE</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
        <span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_NOBODY</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
        <span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_HEADER</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
        <span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_USERAGENT</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>);</span>
        <span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_RETURNTRANSFER</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>

        <span class=nv>$response</span> <span class=o>=</span> <span class=nx>curl_exec</span><span class=p>(</span><span class=nv>$ch</span><span class=p>);</span>
        <span class=nv>$responseInfo</span> <span class=o>=</span> <span class=nx>curl_getinfo</span><span class=p>(</span><span class=nv>$ch</span><span class=p>);</span>
        <span class=nx>curl_close</span><span class=p>(</span><span class=nv>$ch</span><span class=p>);</span>
        <span class=k>return</span> <span class=nv>$response</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p>This last function regex&rsquo;s the parameters passed into it and returns only one match.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>function</span> <span class=nf>get_match</span><span class=p>(</span><span class=nv>$regex</span><span class=p>,</span><span class=nv>$content</span><span class=p>){</span>
    <span class=nx>preg_match</span><span class=p>(</span><span class=nv>$regex</span><span class=p>,</span><span class=nv>$content</span><span class=p>,</span><span class=nv>$matches</span><span class=p>);</span>
    <span class=k>return</span> <span class=nv>$matches</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
<span class=p>}</span>
</code></pre></div><p>You will then need to include the file in your page above where you call it using (assuming you called it <code>weather.php</code>):</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>include</span> <span class=s2>&#34;weather.php&#34;</span><span class=p>;</span>
</code></pre></div><p>Then call the function from the file:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>echo</span> <span class=nv>$weather_class</span><span class=p>;</span>
</code></pre></div><p>Why not follow <a href=https://twitter.com/mylesagray>@mylesagray on Twitter</a> for more like this!</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://blah.cloud/tags/php/>php</a></li>
<li><a href=https://blah.cloud/tags/website/>website</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://blah.cloud/hardware/fix-broken-motherboard/>
<span class=title>« Prev Page</span>
<br>
<span>Fixing/Flashing a broken motherboard w/ SPIPGM2 and Serial</span>
</a>
<a class=next href=https://blah.cloud/miscellaneous/thermite-ftw/>
<span class=title>Next Page »</span>
<br>
<span>Thermite FTW!</span>
</a>
</nav>
<section class="section related-links">
<div class="columns is-centered">
<div class="column max-800px">
<div class=content>
<h2>Related content</h2>
</div>
<div class="columns related-links-columns">
<div class="column is-one-third">
<div class=card>
<div class=card-image>
<figure class="image is-3by2">
<a href=/miscellaneous/thermite-ftw/><img src=/miscellaneous/thermite-ftw/images/Screen-Shot-2014-12-07-at-18.23.34.png alt></a>
</figure>
</div>
<div class=card-content>
<a class="title is-5" href=https://blah.cloud/miscellaneous/thermite-ftw/>Thermite FTW!</a>
</div>
</div>
</div>
<div class="column is-one-third">
<div class=card>
<div class=card-image>
<figure class="image is-3by2">
<a href=/miscellaneous/benchtec-toolbox/><img src=/miscellaneous/benchtec-toolbox/images/ToolboxBig-1.png alt></a>
</figure>
</div>
<div class=card-content>
<a class="title is-5" href=https://blah.cloud/miscellaneous/benchtec-toolbox/>BenchTec Toolbox</a>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share How To: Use geolocation to get a user's location and weather from IP address on twitter" href="https://twitter.com/intent/tweet/?text=How%20To%3a%20Use%20geolocation%20to%20get%20a%20user%27s%20location%20and%20weather%20from%20IP%20address&url=https%3a%2f%2fblah.cloud%2fmiscellaneous%2fuse-geolocation-get-user-location-weather-ip-address%2f&hashtags=php%2cwebsite"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share How To: Use geolocation to get a user's location and weather from IP address on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblah.cloud%2fmiscellaneous%2fuse-geolocation-get-user-location-weather-ip-address%2f&title=How%20To%3a%20Use%20geolocation%20to%20get%20a%20user%27s%20location%20and%20weather%20from%20IP%20address"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share How To: Use geolocation to get a user's location and weather from IP address on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblah.cloud%2fmiscellaneous%2fuse-geolocation-get-user-location-weather-ip-address%2f&title=How%20To%3a%20Use%20geolocation%20to%20get%20a%20user%27s%20location%20and%20weather%20from%20IP%20address&summary=How%20To%3a%20Use%20geolocation%20to%20get%20a%20user%27s%20location%20and%20weather%20from%20IP%20address&source=https%3a%2f%2fblah.cloud%2fmiscellaneous%2fuse-geolocation-get-user-location-weather-ip-address%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
</div>
</footer><script src=https://utteranc.es/client.js repo=mylesagray/blog-comments issue-term=title theme=preferred-color-scheme crossorigin=anonymous async></script>
</article>
</main>
</div>
<footer class=footer>
<span>&copy; 2021 <a href=https://blah.cloud/>Blah, Cloud</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>