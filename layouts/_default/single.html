{{- define "main" }}

{{ if ge (len .TableOfContents) 80}}
<div class="wrapper">
  <!-- Version of the page with table of contents -->
  <article class="post-single">
    <header class="post-header">
      {{ partial "breadcrumbs.html" . }}
      <h1 class="post-title">
        {{ .Title }}
        {{- if .Draft }}<div class="entry-isdraft"><sup>&nbsp;&nbsp;[draft]</sup></div>{{- end }}
      </h1>
      {{- if .Description }}
      <div class="post-description">
        {{ .Description }}
      </div>
      {{- end }}
      {{- if not (.Param "hideMeta") }}
      <div class="post-meta">
        {{- partial "post_meta.html" . -}}
        {{- partial "translation_list.html" . -}}
        {{- partial "edit_post.html" . -}}
      </div>
      {{- end }}
    </header>
    {{- $isHidden := .Params.cover.hidden | default .Site.Params.cover.hiddenInSingle | default .Site.Params.cover.hidden
    }}
    {{- partial "cover.html" (dict "cxt" . "IsHome" false "isHidden" $isHidden) }}
    {{- if (.Param "ShowToc") }}
    {{- partial "toc.html" . }}
    {{- end }}
    <div class="post-content">
      {{- if not (.Param "disableAnchoredHeadings") }}
      {{- partial "anchored_headings.html" .Content -}}
      {{- else }}{{ .Content }}{{ end }}
    </div>
    <footer class="post-footer">
      {{- if .Params.tags }}
      <section class="section post-tags">
        <div class="content">
          <h2>Tagged with</h2>
        </div>
        <ul class="post-tags">
          {{- range ($.GetTerms "tags") }}
          <li><a href="{{ .Permalink }}">{{ .LinkTitle }}</a></li>
          {{- end }}
        </ul>
      </section>
      {{- end }}
      {{- if (.Param "ShowPostNavLinks") }}
      {{- partial "post_nav_links.html" . }}
      {{- end }}
      {{- if (.Param "ShowPostRelatedContent") }}
      <section class="section related-links">
        <div class="columns is-centered">
          <div class="column max-800px">
            <div class="content">
              <h2>Related content</h2>
            </div>
            <div class="columns related-links-columns">
              {{ $related := (where (.Site.RegularPages.Related .) "Type" "post") | first 3 }}
              {{ range $related }}
              <div class="column is-one-third">
                {{ partial "post_card_small.html" . }}
              </div>
              {{ end }}
            </div>
          </div>
        </div>
      </section>
      {{- end }}
      {{- if (and .Site.Params.ShowShareButtons (ne .Params.disableShare true)) }}
      <section class="section share-icons">
        {{- partial "share_icons.html" . -}}
      </section>
      {{- end }}
    </footer>

    {{- if (.Param "comments") }}
    {{- partial "comments.html" . }}
    {{- end }}
  </article>

  <aside class="hidden lg:block tableOfContentContainer" id="tableOfContentContainer">

    {{ .TableOfContents }}
  </aside>
</div>
{{ else }}


  <!-- Version of the page without table of contents -->
  <article class="post-single">
    <header class="post-header">
      {{ partial "breadcrumbs.html" . }}
      <h1 class="post-title">
        {{ .Title }}
        {{- if .Draft }}<div class="entry-isdraft"><sup>&nbsp;&nbsp;[draft]</sup></div>{{- end }}
      </h1>
      {{- if .Description }}
      <div class="post-description">
        {{ .Description }}
      </div>
      {{- end }}
      {{- if not (.Param "hideMeta") }}
      <div class="post-meta">
        {{- partial "post_meta.html" . -}}
        {{- partial "translation_list.html" . -}}
        {{- partial "edit_post.html" . -}}
      </div>
      {{- end }}
    </header>
    {{- $isHidden := .Params.cover.hidden | default .Site.Params.cover.hiddenInSingle | default .Site.Params.cover.hidden
    }}
    {{- partial "cover.html" (dict "cxt" . "IsHome" false "isHidden" $isHidden) }}
    {{- if (.Param "ShowToc") }}
    {{- partial "toc.html" . }}
    {{- end }}
    <div class="post-content">
      {{- if not (.Param "disableAnchoredHeadings") }}
      {{- partial "anchored_headings.html" .Content -}}
      {{- else }}{{ .Content }}{{ end }}
    </div>
    <footer class="post-footer">
      {{- if .Params.tags }}
      <ul class="post-tags">
        {{- range ($.GetTerms "tags") }}
        <li><a href="{{ .Permalink }}">{{ .LinkTitle }}</a></li>
        {{- end }}
      </ul>
      {{- end }}
      {{- if (.Param "ShowPostNavLinks") }}
      {{- partial "post_nav_links.html" . }}
      {{- end }}
      {{- if (.Param "ShowPostRelatedContent") }}
      <section class="section">
        <div class="columns is-centered">
          <div class="column max-800px">
            <div class="content">
              <h2>Related content</h2>
            </div>
            <div class="columns">
              {{ $related := (where (.Site.RegularPages.Related .) "Type" "post") | first 3 }}
              {{ range $related }}
              <div class="column is-one-third">
                {{ partial "post_card_small.html" . }}
              </div>
              {{ end }}
            </div>
          </div>
        </div>
      </section>
      {{- end }}
      {{- if (and .Site.Params.ShowShareButtons (ne .Params.disableShare true)) }}
      {{- partial "share_icons.html" . -}}
      {{- end }}
    </footer>

    {{- if (.Param "comments") }}
    {{- partial "comments.html" . }}
    {{- end }}
  </article>

{{ end }}

{{- end }}{{/* end main */}}
