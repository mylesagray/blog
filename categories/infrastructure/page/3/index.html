<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Infrastructure | Blah, Cloud</title>
<meta name=keywords content>
<meta name=description content="Adventures in architectures">
<meta name=author content="Myles Gray">
<link rel=canonical href=https://blah.cloud/categories/infrastructure/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.881b1a6abcea673c5b98758c1a381c605d13dc9085ffd878dae569a1d8fb4a9a.css integrity="sha256-iBsaarzqZzxbmHWMGjgcYF0T3JCF/9h42uVpodj7Spo=" rel="preload stylesheet" as=style>
<link rel=icon href=https://blah.cloud/images/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://blah.cloud/images/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://blah.cloud/images/favicon-32x32.png>
<link rel=apple-touch-icon href=https://blah.cloud/images/apple-touch-icon.png>
<link rel=mask-icon href=https://blah.cloud/images/logo.png>
<meta name=theme-color media="(prefers-color-scheme: dark)" content="rgba(88, 89, 91, 1)">
<meta name=theme-color content="rgba(240, 202, 102, 1)">
<meta name=msapplication-TileColor content="rgba(240, 202, 102, 1)">
<meta name=generator content="Hugo 0.92.0">
<link rel=alternate type=application/rss+xml href=https://blah.cloud/categories/infrastructure/index.xml>
<meta property="og:title" content="Infrastructure">
<meta property="og:description" content="Adventures in architectures">
<meta property="og:type" content="website">
<meta property="og:url" content="https://blah.cloud/categories/infrastructure/"><meta property="og:image" content="https://blah.cloud/images/og-card.jpg"><meta property="og:site_name" content="Blah, Cloud">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://blah.cloud/images/og-card.jpg">
<meta name=twitter:title content="Infrastructure">
<meta name=twitter:description content="Adventures in architectures">
<meta name=twitter:site content="@mylesagray">
<meta name=twitter:creator content="@mylesagray">
<script defer data-domain=blah.cloud data-api=/backend/api/event src=/backend/js/script.outbound-links.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script>
</head>
<body class=list id=top>
<script>window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches?(document.body.classList.add('dark'),document.body.classList.remove('light')):(document.body.classList.remove('dark'),document.body.classList.add('light'));const darkModeMediaQuery=window.matchMedia('(prefers-color-scheme: dark)');darkModeMediaQuery.addListener(a=>{const b=a.matches;b?(document.body.classList.add('dark'),document.body.classList.remove('light')):(document.body.classList.remove('dark'),document.body.classList.add('light'))})</script>
<noscript>
<style type=text/css>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(240, 202, 102, 1);--secondary:rgba(216, 214, 197, 1);--tertiary:rgb(75, 75, 75);--content:rgba(206, 205, 188, 1);--hljs-bg:#282a36;--code-bg:#282a36;--border:rgba(240, 202, 102, 1);--highlight:rgba(88, 89, 91, 1)}.list{background:var(--theme)}}</style>
</noscript>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://blah.cloud/ accesskey=h title="Blah, Cloud. (Alt + H)">
<picture>
<source media="(min-width: 768px)" srcset=/images/logo-title.avif type=image/avif alt=logo width=245 height=34>
<source media="(min-width: 768px)" srcset=/images/logo-title.webp type=image/webp alt=logo width=245 height=34>
<source media="(min-width: 768px)" srcset=/images/logo-title.png type=image/png alt=logo width=245 height=34>
<source srcset=/images/logo.avif type=image/avif alt=logo width=65 height=65>
<source srcset=/images/logo.webp type=image/webp alt=logo width=65 height=65>
<img class=logo src=/images/logo-title.png alt=logo aria-label=logo width=245 height=34>
</picture></a>
</div>
<span class=logo-switches>
</span>
<span class=hamburger>
<button id=hamburger-toggle accesskey=m title="(Alt + M)"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="28" viewBox="0 0 24 28"><path d="M24 21v2c0 .547-.453 1-1 1H1c-.547.0-1-.453-1-1v-2c0-.547.453-1 1-1h22c.547.0 1 .453 1 1zm0-8v2c0 .547-.453 1-1 1H1c-.547.0-1-.453-1-1v-2c0-.547.453-1 1-1h22c.547.0 1 .453 1 1zm0-8v2c0 .547-.453 1-1 1H1c-.547.0-1-.453-1-1V5c0-.547.453-1 1-1h22c.547.0 1 .453 1 1z"/></svg>
</button>
</span>
<ul id=menu>
<li>
<a href=https://blah.cloud/about/ title=about>
<span>about</span>
</a>
</li>
<li>
<a href=https://blah.cloud/blog/ title=blog>
<span>blog</span>
</a>
</li>
<li>
<a href=https://blah.cloud/now/ title=now>
<span>now</span>
</a>
</li>
<li>
<a href=https://blah.cloud/works/ title=works>
<span>works</span>
</a>
</li>
<li>
<a href=https://blah.cloud/search/ title=" (Alt + /)" accesskey=/>
<span><svg style="height:1em" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="fill-current w-5" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span>
</a>
</li>
</ul>
</nav>
</header>
<div class=container>
<main class=main>
<header class=page-header>
<h1>Infrastructure</h1>
</header>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>Designing a modern multi-tenant DC network
</h2>
</header>
<section class=entry-content>
<p>Over the last 12 months my posting has been dialled back, this isn’t for lack of wanting or ideas, mainly a lack of time and mental bandwidth. Reason being, I have been designing and implementing a new cloud platform (namely “STC” ↗) for my employer, Novosco - as with any new service or product this requires an element of discretion - but now is the time to let slip some of the detail on what makes the service tick!...</p>
</section>
<footer class=entry-footer><span title="2016-10-27 12:00:36 +0000 UTC">October 27, 2016</span>&nbsp;·&nbsp;Myles Gray</footer>
<a class=entry-link aria-label="post link to Designing a modern multi-tenant DC network" href=https://blah.cloud/infrastructure/designing-modern-private-cloud-network/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>My home datacenter.
</h2>
</header>
<section class=entry-content>
<p>I have been meaning to write this for a very long time, finally inspired by seeing Russell Pope’s absolutely insane lab in the vExpert Slack ↗ and Mark Brookfield ↗’s homelab post ↗ it started when my lab was a single Dell R710 with 96GB RAM and 2x X5670 procs. The home lab has stopped being a lab and become a datacenter in that time and it’s about time I put it down on paper....</p>
</section>
<footer class=entry-footer><span title="2016-09-13 23:04:11 +0000 UTC">September 13, 2016</span>&nbsp;·&nbsp;Myles Gray</footer>
<a class=entry-link aria-label="post link to My home datacenter." href=https://blah.cloud/hardware/my-home-datacenter/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>Setting up Duo 2FA for Fortigate admin authentication
</h2>
</header>
<section class=entry-content>
<p>I protect any account I have with two factor auth, at least the ones that support it (this site for example has 2FA for admin logon), it’s not that inconvenient (especially not with Authy/Duo) and greatly increases security of your critical accounts.
Let’s start with the endgame:
However, I haven’t protected my publicly accessible firewall with 2FA - mainly because there is no real built in method for using industry standard apps with it....</p>
</section>
<footer class=entry-footer><span title="2016-08-31 23:08:42 +0000 UTC">August 31, 2016</span>&nbsp;·&nbsp;Myles Gray</footer>
<a class=entry-link aria-label="post link to Setting up Duo 2FA for Fortigate admin authentication" href=https://blah.cloud/infrastructure/setting-duo-2fa-fortigate-admin-authentication/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>Replicating SAN on openSUSE with VAAI
</h2>
</header>
<section class=entry-content>
<p>Preamble This article was written a few years back, but never published - it was some work I was doing in my lab to try and get to grips around the work involved in creating a SAN with synchronous replication built in from scratch.
It in no way should be used for production, but rather as a learning exercise - as previously stated the instructions are a few years old and version specific, so openSUSE may well now support some of the modules I had to compile and create repos for manually, also DRBD9 has been released and should obviously be used in place of DRBD8 as I have below....</p>
</section>
<footer class=entry-footer><span title="2016-08-27 12:59:18 +0000 UTC">August 27, 2016</span>&nbsp;·&nbsp;Myles Gray</footer>
<a class=entry-link aria-label="post link to Replicating SAN on openSUSE with VAAI" href=https://blah.cloud/hardware/replicating-san-opensuse-vaai/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>Configuring Auto Deploy Stateless Caching in vSphere 6.0
</h2>
</header>
<section class=entry-content>
<p>Following on from my previous post on configuring custom ESXi images for PXE deployment, it piqued my interest again in Auto Deploy, now that I have a lab large enough (enough physical failure domains) to justify auto-deploy I figured i’d give it another go. I have chosen to implement stateless caching as it will allow the hosts to boot from the last used ESXi image they had if the PxE/AutoDeploy server goes down - then when it comes back up will pull the new version, this accounts for a total infrastructure outage and still allows the hosts to be bootable....</p>
</section>
<footer class=entry-footer><span title="2016-08-19 21:53:33 +0000 UTC">August 19, 2016</span>&nbsp;·&nbsp;Myles Gray</footer>
<a class=entry-link aria-label="post link to Configuring Auto Deploy Stateless Caching in vSphere 6.0" href=https://blah.cloud/automation/configuring-auto-deploy-stateless-caching-vsphere-6-0/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>Building a customised ESXi image for PXE installation
</h2>
</header>
<section class=entry-content>
<p>Introduction I have recently been working on a larger scale platform for my employer, it requires quick deployments of environments on VSAN with some standardised VIBs added in, initially we were doing this with a standard ESXi ISO install through iDRAC and then installing vCenter, vSphere Update Manager and pushing the VIBs to the hosts via that.
This is clearly a sub-optimal process and given our dedicated lab environment, we wanted to be able to spin up/down environments a bit more quickly - so we looked to optimising the install process and making production ready as the first step (as most people know, VSAN has some stringent HCL requirements when it comes to drivers and firmware)....</p>
</section>
<footer class=entry-footer><span title="2016-08-09 12:40:27 +0000 UTC">August 9, 2016</span>&nbsp;·&nbsp;Myles Gray</footer>
<a class=entry-link aria-label="post link to Building a customised ESXi image for PXE installation" href=https://blah.cloud/infrastructure/building-customised-esxi-image-pxe-installation/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>vSphere Update Manager – Cannot Scan Host
</h2>
</header>
<section class=entry-content>
<p>I have been testing out Runecast Analyzer ↗ in my lab recently - it’s pretty badass, you can set it up to scan your virtual infrastructure at a vCenter level and will scan your vC, VMs and hosts looking for KBs that may apply, security compliance and best practises.
As you can see my lab isn’t exactly a model config when it comes to any of these things:...</p>
</section>
<footer class=entry-footer><span title="2016-05-15 14:29:38 +0000 UTC">May 15, 2016</span>&nbsp;·&nbsp;Myles Gray</footer>
<a class=entry-link aria-label="post link to vSphere Update Manager – Cannot Scan Host" href=https://blah.cloud/virtualisation/vsphere-update-manager-cannot-scan-host/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>Upgrading VMware Integrated Openstack from v2.0.1 to v2.0.3
</h2>
</header>
<section class=entry-content>
<p>I’ve been playing around with VMware Integrated Openstack recently and wanted to see what the upgrade experience for bugfixes and point releases is like, happy to say - it’s quite easy.
Firstly, download the .deb package from my.vmware.com and upload it to the VIO management appliance - I used FileZilla for this, the username is viouser and password is what you set during OVF deploy.
I just uploaded mine to the viouser home folder /home/viouser/...</p>
</section>
<footer class=entry-footer><span title="2016-04-15 20:14:52 +0000 UTC">April 15, 2016</span>&nbsp;·&nbsp;Myles Gray</footer>
<a class=entry-link aria-label="post link to Upgrading VMware Integrated Openstack from v2.0.1 to v2.0.3" href=https://blah.cloud/cloud/upgrading-vmware-integrated-openstack-v2-0-1-v2-0-3/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>Raspberry Pi with Dynamic-DNS using Cloudflare
</h2>
</header>
<section class=entry-content>
<p>My lab is not what you’d call typical in any way, a kit list will i’m sure come up in a future post, but I have what is analogous to a “primary” DC and a “backup” DC with regard to physical premises. The problem is, I live in the secondary with other human beings, meaning power draw and noise are to be kept to a minimum.
I also don’t have the luxury of having a /29 of public addresses at the second site, or even a static address at all....</p>
</section>
<footer class=entry-footer><span title="2016-04-08 18:54:57 +0000 UTC">April 8, 2016</span>&nbsp;·&nbsp;Myles Gray</footer>
<a class=entry-link aria-label="post link to Raspberry Pi with Dynamic-DNS using Cloudflare" href=https://blah.cloud/networks/raspberry-pi-dynamic-dns-using-cloudflare/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>Clone VMDK without vCenter (ESXi Free/Standalone ESXi)
</h2>
</header>
<section class=entry-content>
<p>It’s sometimes necessary to clone VMs when you don’t have a vCenter, either because you plain don’t have one in a small customer environment or you are doing a deploy and don’t have vCenter deployed yet - you’ve created a template VM for Windows or such and want to roll out some DCs and management VMs before your vCenter deploy such that you have DNS etc.
Luckily there is a way to do this through the ESXi host directly, the method I use that I find effective is:...</p>
</section>
<footer class=entry-footer><span title="2016-03-22 09:27:59 +0000 UTC">March 22, 2016</span>&nbsp;·&nbsp;Myles Gray</footer>
<a class=entry-link aria-label="post link to Clone VMDK without vCenter (ESXi Free/Standalone ESXi)" href=https://blah.cloud/infrastructure/clone-vmdk-without-vcenter-esxi-freestandalone-esxi/></a>
</article>
<footer class=page-footer>
<nav class=pagination>
<a class=prev href=https://blah.cloud/categories/infrastructure/page/2/>« Prev Page</a>
<a class=next href=https://blah.cloud/categories/infrastructure/page/4/>Next Page »</a>
</nav>
</footer>
</main>
</div>
<footer class=footer>
<span>&copy; 2022 <a href=https://blah.cloud/>Blah, Cloud</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/JPbaU rel=noopener target=_blank>BurgerMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
</body>
</html>