<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Infrastructure | Blah, Cloud</title><meta name=keywords content><meta name=description content="Adventures in architectures"><meta name=author content="Myles Gray"><link rel=canonical href=https://blah.cloud/categories/infrastructure/><link crossorigin=anonymous href=/assets/css/stylesheet.min.b1da2895238dfeedf27f032004268905e3f3ba403dec0ceb07be46cce8ac5b96.css integrity="sha256-sdoolSON/u3yfwMgBCaJBePzukA97AzrB75GzOisW5Y=" rel="preload stylesheet" as=style><link rel=icon href=https://blah.cloud/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blah.cloud/images/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blah.cloud/images/favicon-32x32.png><link rel=apple-touch-icon href=https://blah.cloud/images/apple-touch-icon.png><link rel=mask-icon href=https://blah.cloud/images/logo.png><meta name=theme-color media="(prefers-color-scheme: dark)" content="rgba(88, 89, 91, 1)"><meta name=theme-color content="rgba(240, 202, 102, 1)"><meta name=msapplication-TileColor content="rgba(240, 202, 102, 1)"><meta name=generator content="Hugo 0.99.1"><link rel=alternate type=application/rss+xml href=https://blah.cloud/categories/infrastructure/index.xml><meta property="og:title" content="Infrastructure"><meta property="og:description" content="Adventures in architectures"><meta property="og:type" content="website"><meta property="og:url" content="https://blah.cloud/categories/infrastructure/"><meta property="og:image" content="https://blah.cloud/images/og-card.jpg"><meta property="og:site_name" content="Blah, Cloud"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blah.cloud/images/og-card.jpg"><meta name=twitter:title content="Infrastructure"><meta name=twitter:description content="Adventures in architectures"><meta name=twitter:site content="@mylesagray"><meta name=twitter:creator content="@mylesagray"><script defer data-domain=blah.cloud data-api=/backend/api/event src=/backend/js/script.outbound-links.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script></head><body class=list id=top><script>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?(document.body.classList.add("dark"),document.body.classList.remove("light")):(document.body.classList.remove("dark"),document.body.classList.add("light"));const darkModeMediaQuery=window.matchMedia("(prefers-color-scheme: dark)");darkModeMediaQuery.addListener(e=>{const t=e.matches;t?(document.body.classList.add("dark"),document.body.classList.remove("light")):(document.body.classList.remove("dark"),document.body.classList.add("light"))})</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(240, 202, 102, 1);--secondary:rgba(216, 214, 197, 1);--tertiary:rgb(75, 75, 75);--content:rgba(206, 205, 188, 1);--hljs-bg:#282a36;--code-bg:#282a36;--border:rgba(240, 202, 102, 1);--highlight:rgba(88, 89, 91, 1)}.list{background:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://blah.cloud/ accesskey=h title="Blah, Cloud. (Alt + H)"><picture><source media="(min-width: 768px)" srcset=/images/logo-title.avif type=image/avif alt=logo width=245 height=34><source media="(min-width: 768px)" srcset=/images/logo-title.webp type=image/webp alt=logo width=245 height=34><source media="(min-width: 768px)" srcset=/images/logo-title.png type=image/png alt=logo width=245 height=34><source srcset=/images/logo.avif type=image/avif alt=logo width=65 height=65><source srcset=/images/logo.webp type=image/webp alt=logo width=65 height=65><img class=logo src=/images/logo-title.png alt=logo aria-label=logo width=245 height=34></picture></a></div><span class=logo-switches></span><span class=hamburger><button id=hamburger-toggle accesskey=m title="(Alt + M)"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="28" viewBox="0 0 24 28"><path d="M24 21v2c0 .547-.453 1-1 1H1c-.547.0-1-.453-1-1v-2c0-.547.453-1 1-1h22c.547.0 1 .453 1 1zm0-8v2c0 .547-.453 1-1 1H1c-.547.0-1-.453-1-1v-2c0-.547.453-1 1-1h22c.547.0 1 .453 1 1zm0-8v2c0 .547-.453 1-1 1H1c-.547.0-1-.453-1-1V5c0-.547.453-1 1-1h22c.547.0 1 .453 1 1z"/></svg></button></span><ul id=menu><li><a href=https://blah.cloud/about/ title=about><span>about</span></a></li><li><a href=https://blah.cloud/blog/ title=blog><span>blog</span></a></li><li><a href=https://blah.cloud/now/ title=now><span>now</span></a></li><li><a href=https://blah.cloud/works/ title=works><span>works</span></a></li><li><a href=https://blah.cloud/search/ title=" (Alt + /)" accesskey=/><span><svg style="height:1em" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="fill-current w-5" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></a></li></ul></nav></header><div class=container><main class=main><header class=page-header><h1>Infrastructure</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2>Increase maximum number of VLANs on HP ProCurve switch</h2></header><section class=entry-content><p>Ran into a maximum VLAN problem (8 VLANs) on my lab HP ProCurve 2824 switches.
This command can be run to increase the max number of VLANs allowed on the switch (in config mode):
max-vlans 256 write memory reload</p></section><a class=entry-link aria-label="post link to Increase maximum number of VLANs on HP ProCurve switch" href=https://blah.cloud/command-line-fu/increase-maximum-number-of-vlans-on-hp-procurve-switch/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Re-mount all unmounted or "lost" NFS Datastores</h2></header><section class=entry-content><p>Particularly useful if you have used DNS for your NFS datastore mounts and have rebooted the host with the only DNS server on it:
esxcfg-nas -r</p></section><a class=entry-link aria-label='post link to Re-mount all unmounted or "lost" NFS Datastores' href=https://blah.cloud/command-line-fu/re-mount-all-unmounted-or-lost-nfs-datastores/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Safely check/remove orphaned VMDK files from ESXi</h2></header><section class=entry-content><p>I have come across a number of environments where mystery “snapshot” files exist - they are not seen in snapshot manager, running a consolidation them doesn’t help, creating a snapshot (with memory, or guest OS quiescing) then running “Delete All” doesn’t resolve it, but some applications still think a snapshot is there.
To take care of these is quite a manual process after you have followed all the VMware KB advice:...</p></section><footer class=entry-footer><span title="2015-02-21 13:53:57 +0000 UTC">February 21, 2015</span>&nbsp;·&nbsp;Myles Gray</footer><a class=entry-link aria-label="post link to Safely check/remove orphaned VMDK files from ESXi" href=https://blah.cloud/infrastructure/safely-checkremove-orphaned-vmdk-files-from-esxi/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Deploying and Installing your first Juju Charm on Vagrant</h2></header><section class=entry-content><p>I’ve been playing with cloud platforms quite a lot recently, and in particular Juju ↗’s way of operations caught my particular attention.
It has a very impressive feature set ↗ and makes deploying and linking “canned” apps very simple, whether you are using public, private or hybrid cloud instances.
I wanted to set Juju up with minimal fuss to give it a quick spin, obviously deploying OpenStack etc is a little more involved for a simple POC than I would have liked and using AWS/Azure/HP Cloud/MAAS was just way overkill....</p></section><footer class=entry-footer><span title="2014-12-14 22:02:07 +0000 UTC">December 14, 2014</span>&nbsp;·&nbsp;Myles Gray</footer><a class=entry-link aria-label="post link to Deploying and Installing your first Juju Charm on Vagrant" href=https://blah.cloud/infrastructure/deploying-installing-first-juju-charm-vagrant/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Utilising Kerberos/AD auth in Ubuntu 14.04 with realmd</h2></header><section class=entry-content><p>It has, over the years always been quite a quandary to get SSO auth working from *nix -> MS AD without a huge amount of fiddling and tinkering, but there is a new auth framework in town by the name of realmd ↗. While tinkering with The Foreman ↗ recently it had dawned on me it would be cool to have it set up such that, after the VM had been automatically provisioned it would allow me to SSH into it using my AD credentials....</p></section><footer class=entry-footer><span title="2014-12-08 01:00:41 +0000 UTC">December 8, 2014</span>&nbsp;·&nbsp;Myles Gray</footer><a class=entry-link aria-label="post link to Utilising Kerberos/AD auth in Ubuntu 14.04 with realmd" href=https://blah.cloud/infrastructure/utilising-kerberosad-auth-ubuntu-14-04-realmd/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Enabling PXE boot options on Fortigate DHCP</h2></header><section class=entry-content><p>I have been recently setting up The Foreman ↗ as a Puppet ↗ management front end to allow me to quickly provision Linux based VMs on my VMware cluster - more on that setup in another article.
I had to create a PXE boot environment for The Foreman to fully automate the provisioning of the VMs, I run a Fortigate 100D ↗ in my lab from which DHCP is served, as you may or may not know, the PXE boot options are served from DHCP ↗....</p></section><footer class=entry-footer><span title="2014-12-07 14:04:09 +0000 UTC">December 7, 2014</span>&nbsp;·&nbsp;Myles Gray</footer><a class=entry-link aria-label="post link to Enabling PXE boot options on Fortigate DHCP" href=https://blah.cloud/infrastructure/enabling-pxe-boot-options-fortigate-dhcp/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Fix for CBT bug in VMWare Products</h2></header><section class=entry-content><p>VMWare, as of writing, has a nasty bug that means your backups that run utilising CBT (hint: if you have basically any enterprise backup product worth its salt, it’s got CBT enabled) it loses track of the changed blocks when the VMDK reaches any Power 2 value of 128GB (128, 256, 512, 1024, etc.) which may make your backup unrecoverable.
The VMWare bug is in KB:
kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2090639 ↗
The remedy for this is to disable and re-enable (reset) CBT on the affected machines, this can be done with the machine powered off or with it turned on by running PowerCLI commands and a snapshot, we will be doing the latter, no one likes downtime ↗:...</p></section><footer class=entry-footer><span title="2014-12-02 18:00:13 +0000 UTC">December 2, 2014</span>&nbsp;·&nbsp;Myles Gray</footer><a class=entry-link aria-label="post link to Fix for CBT bug in VMWare Products" href=https://blah.cloud/infrastructure/fix-cbt-bug-vmware-products/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Setting Up Multi-NIC vMotion in vSphere 5.5</h2></header><section class=entry-content><p>Multi-NIC vMotion is a no-brainer configuration for performance ↗:
Faster maintenance mode operations Better DRS load balance operations Overall reduction in lead time of a manual vMotion process. It was introduced in vSphere 5.0 ↗ and has improved in v5.5 - so let’s get into how to configure it (we’ll be using the vSphere Web Client because that’s what VMWare wants us to do nowadays…).
I don’t have an Enterprise Plus license so no Distributed Switches for me - however, if you do have Distributed Switching licenses you should be able to extrapolate from my Standard Switching how to config yours...</p></section><footer class=entry-footer><span title="2014-06-07 15:11:45 +0000 UTC">June 7, 2014</span>&nbsp;·&nbsp;Myles Gray</footer><a class=entry-link aria-label="post link to Setting Up Multi-NIC vMotion in vSphere 5.5" href=https://blah.cloud/hardware/setting-multi-nic-vmotion-vsphere-5-5/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Updating VMWare Horizon Workspace vApp</h2></header><section class=entry-content><p>It’s fairly straight forward to update your Horizon Workspace vApp to the latest (this is an out-of-hours update due to downtime):
Back up your vApp
Ensure all VAs have connectivity to vapp-updates.vmware.com on port 80
Log into your configurator-va CLI with the root password you set up initially
Run the following command to check for update:
/usr/local/horizon/lib/menu/updatemgr.hzn check It should come back after checking all other appliances in the vApp with something like this:...</p></section><footer class=entry-footer><span title="2014-06-03 19:08:27 +0000 UTC">June 3, 2014</span>&nbsp;·&nbsp;Myles Gray</footer><a class=entry-link aria-label="post link to Updating VMWare Horizon Workspace vApp" href=https://blah.cloud/infrastructure/updating-vmware-horizon-workspace-vapp/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Using NginX as a load-balancer for VMware Horizon View security servers</h2></header><section class=entry-content><p>Introduction I have been deploying a VDI solution recently based on the fantastic VMWare Horizon Suite ↗, one of the important points of deploying the Horizon View ↗ component of this is making it highly available and accessible from the outside for on-the-road users.
The best way I have found to load-balance incoming connections (both internally and externally) is to set up a linux VM and run NginX ↗, which is a reverse caching proxy - it allows us to terminate the SSL connections and load-balance across our backend View Security Servers in a DMZ....</p></section><footer class=entry-footer><span title="2014-04-07 13:32:53 +0000 UTC">April 7, 2014</span>&nbsp;·&nbsp;Myles Gray</footer><a class=entry-link aria-label="post link to Using NginX as a load-balancer for VMware Horizon View security servers" href=https://blah.cloud/infrastructure/using-nginx-load-balancer-vmware-horizon-view-security-servers/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://blah.cloud/categories/infrastructure/page/4/>« Prev Page</a>
<a class=next href=https://blah.cloud/categories/infrastructure/page/6/>Next Page »</a></nav></footer></main></div><footer class=footer><span>&copy; 2022 <a href=https://blah.cloud/>Blah, Cloud</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/JPbaU rel=noopener target=_blank>BurgerMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>